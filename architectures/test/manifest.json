{
  "phases": [
    {
      "phase": "boot-infra",
      "pieces": [
        { "module": "./modules/queue", "port": 4200 },
        { "module": "./modules/event-log", "port": 4400 },
        {
          "module": "./modules/dashboard",
          "port": 4300,
          "options": {
            "widgets": {
              "architecture": [
                {
                  "id": "test-emitter",
                  "title": "Test Emitter",
                  "url": "http://localhost:5700/microfront/emit-button.js",
                  "tagName": "test-emitter",
                  "props": {
                    "bff-url": "http://localhost:5700/api/emit",
                    "auto-interval": "1500"
                  }
                }
              ]
            }
          }
        },
        { "module": "./modules/mysql-simulator", "port": 4500, "options": { "mysqlPort": 3307 } },
        { "module": "./modules/dynamodb-simulator", "port": 4600 },
        { "module": "./modules/redis-simulator", "port": 4700 },
        { "module": "./modules/s3-simulator", "port": 4800 }
      ]
    },
    {
      "phase": "initialize",
      "pieces": [
        {
          "module": "./architectures/test/init/initialize.js",
          "options": {
            "mysql": {
              "schema": "./architectures/test/init/mysql/metrics-schema.sql",
              "host": "localhost",
              "port": 3307,
              "user": "root",
              "password": ""
            },
            "dynamodb": {
              "endpoint": "http://localhost:4600",
              "collections": ["test-messages"]
            },
            "queue": {
              "endpoint": "http://localhost:4200",
              "names": ["test"]
            }
          }
        }
      ]
    },
    {
      "phase": "start-middleware",
      "pieces": [
        {
          "module": "./architectures/test/infra/middleware/queue-to-store.js",
          "options": {
            "queueUrl": "http://localhost:4200/queues/test",
            "pollIntervalMs": 1000,
            "eventLog": {
              "endpoint": "http://localhost:4400",
              "queueName": "test"
            },
            "dynamodb": {
              "endpoint": "http://localhost:4600",
              "collection": "test-messages"
            }
          }
        },
        {
          "module": "./architectures/test/infra/middleware/dynamodb-to-mysql.js",
          "options": {
            "pollIntervalMs": 4000,
            "dynamodb": {
              "endpoint": "http://localhost:4600",
              "collection": "test-messages",
              "pageSize": 100
            },
            "mysql": {
              "host": "localhost",
              "port": 3307,
              "user": "root",
              "password": ""
            }
          }
        },
        {
          "module": "./architectures/test/infra/middleware/logs-to-redis-s3.js",
          "options": {
            "pollIntervalMs": 6000,
            "eventLog": {
              "endpoint": "http://localhost:4400",
              "queueName": "test"
            },
            "redis": {
              "endpoint": "http://localhost:4700",
              "key": "test:lastProcessed"
            },
            "s3": {
              "endpoint": "http://localhost:4800",
              "prefix": "test-logs"
            }
          }
        }
      ]
    },
    {
      "phase": "start-services",
      "pieces": [
        {
          "module": "./architectures/test/services/emitter/bff/index.js",
          "port": 5700,
          "options": {
            "queueUrl": "http://localhost:4200/queues/test/messages",
            "microfrontPath": "./architectures/test/services/emitter/microfront/EmitButton.microfrontend"
          }
        }
      ]
    }
  ]
}
